2025-10-20 17:35:57,612 - root - INFO - setup_logging:135 - Logging setup complete. Log file: C:\Users\LENOVO\Desktop\prints\output\processing.log
2025-10-20 17:35:57,614 - root - INFO - timer:148 - Starting: Configuration loading and validation
2025-10-20 17:35:57,616 - src.data.load_data - WARNING - load_config:53 - Default configuration file not found at c:\Users\LENOVO\Desktop\prints\src\configurations\defaults.yaml. Proceeding without defaults.
2025-10-20 17:35:57,624 - src.data.load_data - INFO - load_config:61 - Loading specific configuration from C:\Users\LENOVO\Desktop\prints\configurations\pattern_configs\block_config.yaml...
2025-10-20 17:35:57,625 - src.data.load_data - INFO - load_config:66 - Merged specific configuration over defaults.
2025-10-20 17:35:57,625 - src.data.load_data - INFO - load_config:77 - Configuration loaded successfully.
2025-10-20 17:35:57,627 - root - ERROR - validate_processing_config:238 - Configuration validation failed: Missing required segmentation keys (checked root and 'segmentation_params'): ['k_values', 'som_values']
2025-10-20 17:35:57,627 - root - INFO - timer:154 - Completed: Configuration loading and validation in 0.01 seconds
2025-10-20 17:35:57,628 - root - ERROR - main:565 - An unexpected error occurred in main execution: Processing configuration validation failed.
Traceback (most recent call last):
  File "c:\Users\LENOVO\Desktop\prints\src\main.py", line 481, in main
    if not validate_processing_config(config): raise ValueError("Processing configuration validation failed.")
ValueError: Processing configuration validation failed.
2025-10-20 17:35:57,630 - root - INFO - main:572 - ================================================================================
PROCESSING COMPLETED IN 0.02 SECONDS
================================================================================
2025-10-20 17:35:57,638 - root - INFO - main:580 - Profiling results saved to: C:\Users\LENOVO\Desktop\prints\output\profile_stats.txt
2025-10-20 20:19:41,403 - root - INFO - setup_logging:135 - Logging setup complete. Log file: C:\Users\LENOVO\Desktop\prints\output\processing.log
2025-10-20 20:19:41,403 - root - INFO - timer:148 - Starting: Configuration loading and validation
2025-10-20 20:19:41,413 - src.data.load_data - INFO - load_config:51 - Loaded default configuration from c:\Users\LENOVO\Desktop\prints\configurations\defaults.yaml
2025-10-20 20:19:41,417 - src.data.load_data - INFO - load_config:61 - Loading specific configuration from C:\Users\LENOVO\Desktop\prints\configurations\pattern_configs\block_config.yaml...
2025-10-20 20:19:41,418 - src.data.load_data - INFO - load_config:66 - Merged specific configuration over defaults.
2025-10-20 20:19:41,420 - src.data.load_data - INFO - load_config:77 - Configuration loaded successfully.
2025-10-20 20:19:41,420 - root - ERROR - validate_processing_config:238 - Configuration validation failed: Missing required keys within 'segmentation_params': ['distance_threshold', 'predefined_k', 'k_values', 'som_values']
2025-10-20 20:19:41,420 - root - INFO - timer:154 - Completed: Configuration loading and validation in 0.02 seconds
2025-10-20 20:19:41,420 - root - ERROR - main:565 - An unexpected error occurred in main execution: Processing configuration validation failed.
Traceback (most recent call last):
  File "c:\Users\LENOVO\Desktop\prints\src\main.py", line 481, in main
    if not validate_processing_config(config): raise ValueError("Processing configuration validation failed.")
ValueError: Processing configuration validation failed.
2025-10-20 20:19:41,420 - root - INFO - main:572 - ================================================================================
PROCESSING COMPLETED IN 0.02 SECONDS
================================================================================
2025-10-20 20:19:41,431 - root - INFO - main:580 - Profiling results saved to: C:\Users\LENOVO\Desktop\prints\output\profile_stats.txt
2025-10-20 20:21:47,638 - root - INFO - setup_logging:135 - Logging setup complete. Log file: C:\Users\LENOVO\Desktop\prints\output\processing.log
2025-10-20 20:21:47,639 - root - INFO - timer:148 - Starting: Configuration loading and validation
2025-10-20 20:21:47,652 - src.data.load_data - INFO - load_config:51 - Loaded default configuration from c:\Users\LENOVO\Desktop\prints\configurations\defaults.yaml
2025-10-20 20:21:47,655 - src.data.load_data - INFO - load_config:61 - Loading specific configuration from C:\Users\LENOVO\Desktop\prints\configurations\pattern_configs\block_config.yaml...
2025-10-20 20:21:47,656 - src.data.load_data - INFO - load_config:66 - Merged specific configuration over defaults.
2025-10-20 20:21:47,657 - src.data.load_data - INFO - load_config:77 - Configuration loaded successfully.
2025-10-20 20:21:47,660 - root - INFO - validate_processing_config:232 - Processing configuration validation passed
2025-10-20 20:21:47,661 - root - INFO - timer:154 - Completed: Configuration loading and validation in 0.02 seconds
2025-10-20 20:21:47,666 - src.utils.output_manager - INFO - __init__:28 - OutputManager initialized for dataset 'block' at C:\Users\LENOVO\Desktop\prints\output\datasets\block
2025-10-20 20:21:47,666 - root - INFO - main:489 - Processing dataset: block
2025-10-20 20:21:47,667 - root - INFO - timer:148 - Starting: Loading all test images
2025-10-20 20:21:48,328 - src.utils.output_manager - INFO - save_test_image:77 - Saved test image copy to datasets\block\inputs\test_images\block1.jpg
2025-10-20 20:21:49,296 - src.utils.output_manager - INFO - save_test_image:77 - Saved test image copy to datasets\block\inputs\test_images\block2.jpg
2025-10-20 20:21:49,775 - src.utils.output_manager - INFO - save_test_image:77 - Saved test image copy to datasets\block\inputs\test_images\block3.jpg
2025-10-20 20:21:50,311 - src.utils.output_manager - INFO - save_test_image:77 - Saved test image copy to datasets\block\inputs\test_images\block4.jpg
2025-10-20 20:21:50,845 - src.utils.output_manager - INFO - save_test_image:77 - Saved test image copy to datasets\block\inputs\test_images\block5.jpg
2025-10-20 20:21:50,849 - root - INFO - timer:154 - Completed: Loading all test images in 3.18 seconds
2025-10-20 20:21:50,849 - root - INFO - timer:148 - Starting: Loading training data
2025-10-20 20:21:50,849 - src.data.load_data - INFO - load_data:150 - Processing 5 images for training data...
2025-10-20 20:21:52,810 - src.data.load_data - INFO - load_data:184 - Successfully loaded and processed 5/5 images.
2025-10-20 20:21:52,810 - src.data.load_data - INFO - load_data:185 - rgb_data shape: (5, 30000), lab_data shape: (5, 30000)
2025-10-20 20:21:52,810 - root - INFO - validate_loaded_data:267 - Data validation passed: 50000 total pixels available from 5 images.
2025-10-20 20:21:52,810 - root - INFO - timer:154 - Completed: Loading training data in 1.97 seconds
2025-10-20 20:21:52,825 - root - INFO - timer:148 - Starting: DBN initialization and training
2025-10-20 20:21:52,825 - src.models.dbn_trainer - INFO - __init__:48 - DBNTrainer initialized.
2025-10-20 20:21:52,825 - src.models.dbn_trainer - INFO - train:64 - Starting DBN training and PSO optimization process...
2025-10-20 20:21:52,826 - src.data.preprocess - INFO - efficient_data_sampling:207 - Sampling 800 total samples from flattened data, max 160 per image
2025-10-20 20:21:52,831 - src.data.preprocess - INFO - efficient_data_sampling:282 - Sampling completed: 800 samples extracted.
2025-10-20 20:21:52,832 - src.data.preprocess - INFO - efficient_data_sampling:283 - RGB range: [32.00, 214.00]
2025-10-20 20:21:52,833 - src.data.preprocess - INFO - efficient_data_sampling:284 - LAB ranges: L[12.16, 84.71], a[-2.00, 3.00], b[-1.00, 8.00]
2025-10-20 20:21:52,836 - src.models.dbn_trainer - INFO - train:77 - Training set: (640, 3), Test set: (160, 3)
2025-10-20 20:21:52,837 - src.models.dbn_trainer - INFO - _prepare_scalers:109 - Preparing and fitting scalers...
2025-10-20 20:21:52,838 - src.models.dbn_trainer - INFO - _prepare_scalers:128 - Scaled training data - X: (640, 3), Y: (640, 3)
2025-10-20 20:21:52,838 - src.models.dbn_trainer - INFO - _prepare_scalers:129 - X range: [0.000, 1.000]
2025-10-20 20:21:52,838 - src.models.dbn_trainer - INFO - _prepare_scalers:130 - Y range: [0.000, 1.000]
2025-10-20 20:21:52,843 - src.models.pso_dbn - INFO - __init__:89 - Initializing DBN with architecture: 3 -> [100, 50, 25] -> 3
2025-10-20 20:21:53,226 - src.models.pso_dbn - INFO - _build_model:141 - DBN model built with 7503 parameters
2025-10-20 20:21:53,311 - src.models.dbn_trainer - INFO - train:88 - Initial model has 20 weight layers
2025-10-20 20:21:53,311 - src.models.dbn_trainer - INFO - train:90 - Layer 0: shape (3, 100), range [-0.239, 0.237]
2025-10-20 20:21:53,311 - src.models.dbn_trainer - INFO - train:90 - Layer 1: shape (100,), range [0.000, 0.000]
2025-10-20 20:21:53,311 - src.models.dbn_trainer - INFO - train:90 - Layer 2: shape (100,), range [1.000, 1.000]
2025-10-20 20:21:53,311 - src.models.dbn_trainer - INFO - train:90 - Layer 3: shape (100,), range [0.000, 0.000]
2025-10-20 20:21:53,311 - src.models.dbn_trainer - INFO - train:90 - Layer 4: shape (100,), range [0.000, 0.000]
2025-10-20 20:21:53,311 - src.models.dbn_trainer - INFO - train:90 - Layer 5: shape (100,), range [1.000, 1.000]
2025-10-20 20:21:53,311 - src.models.dbn_trainer - INFO - train:90 - Layer 6: shape (100, 50), range [-0.200, 0.200]
2025-10-20 20:21:53,311 - src.models.dbn_trainer - INFO - train:90 - Layer 7: shape (50,), range [0.000, 0.000]
2025-10-20 20:21:53,311 - src.models.dbn_trainer - INFO - train:90 - Layer 8: shape (50,), range [1.000, 1.000]
2025-10-20 20:21:53,311 - src.models.dbn_trainer - INFO - train:90 - Layer 9: shape (50,), range [0.000, 0.000]
2025-10-20 20:21:53,311 - src.models.dbn_trainer - INFO - train:90 - Layer 10: shape (50,), range [0.000, 0.000]
2025-10-20 20:21:53,311 - src.models.dbn_trainer - INFO - train:90 - Layer 11: shape (50,), range [1.000, 1.000]
2025-10-20 20:21:53,311 - src.models.dbn_trainer - INFO - train:90 - Layer 12: shape (50, 25), range [-0.282, 0.283]
2025-10-20 20:21:53,311 - src.models.dbn_trainer - INFO - train:90 - Layer 13: shape (25,), range [0.000, 0.000]
2025-10-20 20:21:53,322 - src.models.dbn_trainer - INFO - train:90 - Layer 14: shape (25,), range [1.000, 1.000]
2025-10-20 20:21:53,322 - src.models.dbn_trainer - INFO - train:90 - Layer 15: shape (25,), range [0.000, 0.000]
2025-10-20 20:21:53,322 - src.models.dbn_trainer - INFO - train:90 - Layer 16: shape (25,), range [0.000, 0.000]
2025-10-20 20:21:53,323 - src.models.dbn_trainer - INFO - train:90 - Layer 17: shape (25,), range [1.000, 1.000]
2025-10-20 20:21:53,323 - src.models.dbn_trainer - INFO - train:90 - Layer 18: shape (25, 3), range [-0.458, 0.434]
2025-10-20 20:21:53,323 - src.models.dbn_trainer - INFO - train:90 - Layer 19: shape (3,), range [0.000, 0.000]
2025-10-20 20:21:53,324 - src.models.dbn_trainer - INFO - _run_pso_with_retries:139 - PSO optimization attempt 1/3
2025-10-20 20:21:53,324 - src.models.pso_dbn - INFO - optimize:253 - Starting PSO optimization with config: {'swarmsize': 20, 'maxiter': 50, 'w': 0.7, 'c1': 2.0, 'c2': 2.0}
2025-10-20 20:24:26,036 - src.models.pso_dbn - INFO - optimize:326 - PSO optimization completed in 152.71s - Final fitness: 0.014764
2025-10-20 20:24:26,036 - src.models.dbn_trainer - INFO - _run_pso_with_retries:154 - PSO optimization completed successfully
2025-10-20 20:24:26,059 - src.models.dbn_trainer - INFO - train:96 - DBN training and PSO optimization complete.
2025-10-20 20:24:26,060 - root - INFO - timer:154 - Completed: DBN initialization and training in 153.24 seconds
2025-10-20 20:24:26,061 - root - INFO - timer:148 - Starting: Reference image loading and processing
2025-10-20 20:24:27,600 - src.utils.output_manager - INFO - save_reference_image:67 - Saved reference image copy to datasets\block\inputs\reference_image\reference.png
2025-10-20 20:24:27,600 - root - INFO - process_reference_image:204 - Processing reference image: C:\Users\LENOVO\Desktop\prints\dataset\block\reference.jpg
2025-10-20 20:24:27,600 - root - INFO - timer:154 - Completed: Reference image loading and processing in 1.54 seconds
2025-10-20 20:24:27,600 - root - ERROR - main:565 - An unexpected error occurred in main execution: __init__() got an unexpected keyword argument 'initial_resize'
Traceback (most recent call last):
  File "c:\Users\LENOVO\Desktop\prints\src\main.py", line 522, in main
    target_colors_lab, ref_kmeans, ref_som = run_reference_processing(
  File "c:\Users\LENOVO\Desktop\prints\src\main.py", line 337, in run_reference_processing
    reference_results = process_reference_image(
  File "c:\Users\LENOVO\Desktop\prints\src\utils\image_utils.py", line 207, in process_reference_image
    preprocessor = Preprocessor(
TypeError: __init__() got an unexpected keyword argument 'initial_resize'
2025-10-20 20:24:27,613 - root - INFO - main:572 - ================================================================================
PROCESSING COMPLETED IN 159.98 SECONDS
================================================================================
2025-10-20 20:24:27,658 - root - INFO - main:580 - Profiling results saved to: C:\Users\LENOVO\Desktop\prints\output\profile_stats.txt
2025-10-20 21:03:15,264 - root - INFO - setup_logging:135 - Logging setup complete. Log file: C:\Users\LENOVO\Desktop\prints\output\processing.log
2025-10-20 21:03:15,265 - root - INFO - timer:148 - Starting: Configuration loading and validation
2025-10-20 21:03:15,283 - src.data.load_data - INFO - load_config:51 - Loaded default configuration from c:\Users\LENOVO\Desktop\prints\configurations\defaults.yaml
2025-10-20 21:03:15,288 - src.data.load_data - INFO - load_config:61 - Loading specific configuration from C:\Users\LENOVO\Desktop\prints\configurations\pattern_configs\block_config.yaml...
2025-10-20 21:03:15,289 - src.data.load_data - INFO - load_config:66 - Merged specific configuration over defaults.
2025-10-20 21:03:15,289 - src.data.load_data - INFO - load_config:77 - Configuration loaded successfully.
2025-10-20 21:03:15,292 - root - INFO - validate_processing_config:232 - Processing configuration validation passed
2025-10-20 21:03:15,293 - root - INFO - timer:154 - Completed: Configuration loading and validation in 0.03 seconds
2025-10-20 21:03:15,296 - src.utils.output_manager - INFO - __init__:28 - OutputManager initialized for dataset 'block' at C:\Users\LENOVO\Desktop\prints\output\datasets\block
2025-10-20 21:03:15,297 - root - INFO - main:500 - Processing dataset: block
2025-10-20 21:03:15,297 - root - INFO - timer:148 - Starting: Loading all test images
2025-10-20 21:03:15,983 - src.utils.output_manager - INFO - save_test_image:77 - Saved test image copy to datasets\block\inputs\test_images\block1.jpg
2025-10-20 21:03:16,802 - src.utils.output_manager - INFO - save_test_image:77 - Saved test image copy to datasets\block\inputs\test_images\block2.jpg
2025-10-20 21:03:17,249 - src.utils.output_manager - INFO - save_test_image:77 - Saved test image copy to datasets\block\inputs\test_images\block3.jpg
2025-10-20 21:03:17,751 - src.utils.output_manager - INFO - save_test_image:77 - Saved test image copy to datasets\block\inputs\test_images\block4.jpg
2025-10-20 21:03:18,251 - src.utils.output_manager - INFO - save_test_image:77 - Saved test image copy to datasets\block\inputs\test_images\block5.jpg
2025-10-20 21:03:18,251 - root - INFO - timer:154 - Completed: Loading all test images in 2.95 seconds
2025-10-20 21:03:18,252 - root - INFO - timer:148 - Starting: Loading training data
2025-10-20 21:03:18,252 - src.data.load_data - INFO - load_data:150 - Processing 5 images for training data...
2025-10-20 21:03:20,185 - src.data.load_data - INFO - load_data:184 - Successfully loaded and processed 5/5 images.
2025-10-20 21:03:20,185 - src.data.load_data - INFO - load_data:185 - rgb_data shape: (5, 30000), lab_data shape: (5, 30000)
2025-10-20 21:03:20,189 - root - INFO - validate_loaded_data:267 - Data validation passed: 50000 total pixels available from 5 images.
2025-10-20 21:03:20,189 - root - INFO - timer:154 - Completed: Loading training data in 1.94 seconds
2025-10-20 21:03:20,189 - root - INFO - timer:148 - Starting: DBN initialization and training
2025-10-20 21:03:20,189 - src.models.dbn_trainer - INFO - __init__:48 - DBNTrainer initialized.
2025-10-20 21:03:20,190 - src.models.dbn_trainer - INFO - train:64 - Starting DBN training and PSO optimization process...
2025-10-20 21:03:20,190 - src.data.preprocess - INFO - efficient_data_sampling:207 - Sampling 800 total samples from flattened data, max 160 per image
2025-10-20 21:03:20,192 - src.data.preprocess - INFO - efficient_data_sampling:282 - Sampling completed: 800 samples extracted.
2025-10-20 21:03:20,192 - src.data.preprocess - INFO - efficient_data_sampling:283 - RGB range: [30.00, 213.00]
2025-10-20 21:03:20,192 - src.data.preprocess - INFO - efficient_data_sampling:284 - LAB ranges: L[10.98, 84.31], a[-2.00, 3.00], b[-1.00, 8.00]
2025-10-20 21:03:20,194 - src.models.dbn_trainer - INFO - train:77 - Training set: (640, 3), Test set: (160, 3)
2025-10-20 21:03:20,194 - src.models.dbn_trainer - INFO - _prepare_scalers:109 - Preparing and fitting scalers...
2025-10-20 21:03:20,197 - src.models.dbn_trainer - INFO - _prepare_scalers:128 - Scaled training data - X: (640, 3), Y: (640, 3)
2025-10-20 21:03:20,197 - src.models.dbn_trainer - INFO - _prepare_scalers:129 - X range: [0.000, 1.000]
2025-10-20 21:03:20,197 - src.models.dbn_trainer - INFO - _prepare_scalers:130 - Y range: [0.000, 1.000]
2025-10-20 21:03:20,197 - src.models.pso_dbn - INFO - __init__:89 - Initializing DBN with architecture: 3 -> [100, 50, 25] -> 3
2025-10-20 21:03:20,475 - src.models.pso_dbn - INFO - _build_model:141 - DBN model built with 7503 parameters
2025-10-20 21:03:20,524 - src.models.dbn_trainer - INFO - train:88 - Initial model has 20 weight layers
2025-10-20 21:03:20,524 - src.models.dbn_trainer - INFO - train:90 - Layer 0: shape (3, 100), range [-0.241, 0.239]
2025-10-20 21:03:20,524 - src.models.dbn_trainer - INFO - train:90 - Layer 1: shape (100,), range [0.000, 0.000]
2025-10-20 21:03:20,524 - src.models.dbn_trainer - INFO - train:90 - Layer 2: shape (100,), range [1.000, 1.000]
2025-10-20 21:03:20,524 - src.models.dbn_trainer - INFO - train:90 - Layer 3: shape (100,), range [0.000, 0.000]
2025-10-20 21:03:20,525 - src.models.dbn_trainer - INFO - train:90 - Layer 4: shape (100,), range [0.000, 0.000]
2025-10-20 21:03:20,525 - src.models.dbn_trainer - INFO - train:90 - Layer 5: shape (100,), range [1.000, 1.000]
2025-10-20 21:03:20,525 - src.models.dbn_trainer - INFO - train:90 - Layer 6: shape (100, 50), range [-0.200, 0.200]
2025-10-20 21:03:20,525 - src.models.dbn_trainer - INFO - train:90 - Layer 7: shape (50,), range [0.000, 0.000]
2025-10-20 21:03:20,525 - src.models.dbn_trainer - INFO - train:90 - Layer 8: shape (50,), range [1.000, 1.000]
2025-10-20 21:03:20,525 - src.models.dbn_trainer - INFO - train:90 - Layer 9: shape (50,), range [0.000, 0.000]
2025-10-20 21:03:20,525 - src.models.dbn_trainer - INFO - train:90 - Layer 10: shape (50,), range [0.000, 0.000]
2025-10-20 21:03:20,525 - src.models.dbn_trainer - INFO - train:90 - Layer 11: shape (50,), range [1.000, 1.000]
2025-10-20 21:03:20,525 - src.models.dbn_trainer - INFO - train:90 - Layer 12: shape (50, 25), range [-0.282, 0.283]
2025-10-20 21:03:20,526 - src.models.dbn_trainer - INFO - train:90 - Layer 13: shape (25,), range [0.000, 0.000]
2025-10-20 21:03:20,526 - src.models.dbn_trainer - INFO - train:90 - Layer 14: shape (25,), range [1.000, 1.000]
2025-10-20 21:03:20,526 - src.models.dbn_trainer - INFO - train:90 - Layer 15: shape (25,), range [0.000, 0.000]
2025-10-20 21:03:20,526 - src.models.dbn_trainer - INFO - train:90 - Layer 16: shape (25,), range [0.000, 0.000]
2025-10-20 21:03:20,526 - src.models.dbn_trainer - INFO - train:90 - Layer 17: shape (25,), range [1.000, 1.000]
2025-10-20 21:03:20,526 - src.models.dbn_trainer - INFO - train:90 - Layer 18: shape (25, 3), range [-0.463, 0.443]
2025-10-20 21:03:20,526 - src.models.dbn_trainer - INFO - train:90 - Layer 19: shape (3,), range [0.000, 0.000]
2025-10-20 21:03:20,526 - src.models.dbn_trainer - INFO - _run_pso_with_retries:139 - PSO optimization attempt 1/3
2025-10-20 21:03:20,527 - src.models.pso_dbn - INFO - optimize:253 - Starting PSO optimization with config: {'swarmsize': 20, 'maxiter': 50, 'w': 0.7, 'c1': 2.0, 'c2': 2.0}
2025-10-20 21:05:53,818 - src.models.pso_dbn - INFO - optimize:326 - PSO optimization completed in 153.29s - Final fitness: 0.048023
2025-10-20 21:05:53,819 - src.models.dbn_trainer - INFO - _run_pso_with_retries:154 - PSO optimization completed successfully
2025-10-20 21:05:53,828 - src.models.dbn_trainer - INFO - train:96 - DBN training and PSO optimization complete.
2025-10-20 21:05:53,828 - root - INFO - timer:154 - Completed: DBN initialization and training in 153.64 seconds
2025-10-20 21:05:53,829 - root - INFO - timer:148 - Starting: Reference image loading and processing
2025-10-20 21:05:55,386 - src.utils.output_manager - INFO - save_reference_image:67 - Saved reference image copy to datasets\block\inputs\reference_image\reference.png
2025-10-20 21:05:55,387 - root - INFO - process_reference_image:149 - Processing reference image: C:\Users\LENOVO\Desktop\prints\dataset\block\reference.jpg
2025-10-20 21:05:55,807 - root - INFO - process_reference_image:160 - Starting preprocessing for reference image
2025-10-20 21:05:55,807 - src.data.preprocess - INFO - preprocess:140 - Starting preprocessing for image with shape: (4480, 4480, 3)
2025-10-20 21:05:55,834 - src.data.preprocess - INFO - preprocess:153 - Initial resize from 4480x4480 to 512x512
2025-10-20 21:05:57,163 - src.data.preprocess - INFO - preprocess:157 - Applied non-local means denoising with h=10
2025-10-20 21:05:57,478 - src.data.preprocess - INFO - estimate_n_colors:64 - Estimated 299 unique colors, setting n_colors to 8 (max_colors=8)
2025-10-20 21:05:58,342 - src.data.preprocess - INFO - quantize_image:106 - Quantized to 8 target colors. Final unique colors: 8
2025-10-20 21:05:58,344 - src.data.preprocess - INFO - preprocess:176 - Resized to target size (128, 128)
2025-10-20 21:05:58,344 - src.data.preprocess - INFO - preprocess:178 - Preprocessing completed
2025-10-20 21:05:58,345 - root - INFO - process_reference_image:166 - Preprocessing completed for reference image
2025-10-20 21:05:58,345 - root - INFO - process_reference_image:173 - Determining optimal number of clusters for reference image
2025-10-20 21:05:58,356 - src.models.segmentation.segmentation - INFO - determine_k:100 - Unique colors: 111. Adjusted k-range: [2, 5]
2025-10-20 21:05:58,356 - src.models.segmentation.segmentation - INFO - determine_k:114 - Testing k=2
2025-10-20 21:06:00,262 - src.models.segmentation.segmentation - INFO - determine_k:128 - Metrics for k=2: Silhouette=0.970, CH=1840960.0
2025-10-20 21:06:00,262 - src.models.segmentation.segmentation - INFO - determine_k:114 - Testing k=3
2025-10-20 21:06:02,131 - src.models.segmentation.segmentation - INFO - determine_k:128 - Metrics for k=3: Silhouette=0.946, CH=1520209.9
2025-10-20 21:06:02,131 - src.models.segmentation.segmentation - INFO - determine_k:114 - Testing k=4
2025-10-20 21:06:03,992 - src.models.segmentation.segmentation - INFO - determine_k:128 - Metrics for k=4: Silhouette=0.804, CH=1911022.0
2025-10-20 21:06:03,993 - src.models.segmentation.segmentation - INFO - determine_k:114 - Testing k=5
2025-10-20 21:06:05,894 - src.models.segmentation.segmentation - INFO - determine_k:128 - Metrics for k=5: Silhouette=0.801, CH=2083692.1
2025-10-20 21:06:05,896 - src.models.segmentation.segmentation - INFO - determine_k:152 - Optimal k determined: 2 (scores: [0.7846142  0.43003193 0.35451055 0.5       ])
2025-10-20 21:06:05,896 - root - INFO - process_reference_image:195 - Optimal number of clusters determined for reference: 2
2025-10-20 21:06:05,896 - root - INFO - process_reference_image:201 - Determining the number of clusters using DPC (for reference info)
2025-10-20 21:06:05,911 - root - INFO - optimal_clusters_dpc:92 - Number of unique colors: 111. Adjusting max_k to: 10
2025-10-20 21:06:05,912 - root - ERROR - optimal_clusters_dpc:117 - Error in calculating optimal clusters using DPC: unsupported operand type(s) for /: 'generator' and 'int'. Falling back to default k: 2
2025-10-20 21:06:05,912 - root - INFO - process_reference_image:209 - Performing reference segmentation with k=2
2025-10-20 21:06:05,912 - src.models.segmentation.segmentation - INFO - __init__:201 - KMeansSegmenter initialized with k_type: predefined
2025-10-20 21:06:05,912 - root - ERROR - process_reference_image:275 - Error during reference segmentation execution: name 'time' is not defined
Traceback (most recent call last):
  File "c:\Users\LENOVO\Desktop\prints\src\utils\image_utils.py", line 231, in process_reference_image
    kmeans_result: SegmentationResult = kmeans_segmenter.segment()
  File "c:\Users\LENOVO\Desktop\prints\src\models\segmentation\segmentation.py", line 204, in segment
    start_time = time.time()
NameError: name 'time' is not defined
2025-10-20 21:06:05,917 - root - INFO - process_reference_image:282 - Reference image processing finished in 10.53 seconds.
2025-10-20 21:06:05,924 - root - INFO - timer:154 - Completed: Reference image loading and processing in 12.09 seconds
2025-10-20 21:06:05,925 - root - ERROR - main:576 - An unexpected error occurred in main execution: Failed to process reference image or received unexpected result format.
Traceback (most recent call last):
  File "c:\Users\LENOVO\Desktop\prints\src\main.py", line 533, in main
    target_colors_lab, ref_kmeans, ref_som = run_reference_processing(
  File "c:\Users\LENOVO\Desktop\prints\src\main.py", line 354, in run_reference_processing
    raise ValueError("Failed to process reference image or received unexpected result format.")
ValueError: Failed to process reference image or received unexpected result format.
2025-10-20 21:06:05,938 - root - INFO - main:583 - ================================================================================
PROCESSING COMPLETED IN 170.68 SECONDS
================================================================================
2025-10-20 21:06:05,992 - root - INFO - main:591 - Profiling results saved to: C:\Users\LENOVO\Desktop\prints\output\profile_stats.txt
2025-10-20 21:12:00,050 - root - INFO - setup_logging:135 - Logging setup complete. Log file: C:\Users\LENOVO\Desktop\prints\output\processing.log
2025-10-20 21:12:00,051 - root - INFO - timer:148 - Starting: Configuration loading and validation
2025-10-20 21:12:00,062 - src.data.load_data - INFO - load_config:51 - Loaded default configuration from c:\Users\LENOVO\Desktop\prints\configurations\defaults.yaml
2025-10-20 21:12:00,067 - src.data.load_data - INFO - load_config:61 - Loading specific configuration from C:\Users\LENOVO\Desktop\prints\configurations\pattern_configs\block_config.yaml...
2025-10-20 21:12:00,067 - src.data.load_data - INFO - load_config:66 - Merged specific configuration over defaults.
2025-10-20 21:12:00,067 - src.data.load_data - INFO - load_config:77 - Configuration loaded successfully.
2025-10-20 21:12:00,070 - root - INFO - validate_processing_config:232 - Processing configuration validation passed
2025-10-20 21:12:00,071 - root - INFO - timer:154 - Completed: Configuration loading and validation in 0.02 seconds
2025-10-20 21:12:00,073 - src.utils.output_manager - INFO - __init__:28 - OutputManager initialized for dataset 'block' at C:\Users\LENOVO\Desktop\prints\output\datasets\block
2025-10-20 21:12:00,073 - root - INFO - main:500 - Processing dataset: block
2025-10-20 21:12:00,074 - root - INFO - timer:148 - Starting: Loading all test images
2025-10-20 21:12:00,712 - src.utils.output_manager - INFO - save_test_image:77 - Saved test image copy to datasets\block\inputs\test_images\block1.jpg
2025-10-20 21:12:01,524 - src.utils.output_manager - INFO - save_test_image:77 - Saved test image copy to datasets\block\inputs\test_images\block2.jpg
2025-10-20 21:12:01,967 - src.utils.output_manager - INFO - save_test_image:77 - Saved test image copy to datasets\block\inputs\test_images\block3.jpg
2025-10-20 21:12:02,470 - src.utils.output_manager - INFO - save_test_image:77 - Saved test image copy to datasets\block\inputs\test_images\block4.jpg
2025-10-20 21:12:03,005 - src.utils.output_manager - INFO - save_test_image:77 - Saved test image copy to datasets\block\inputs\test_images\block5.jpg
2025-10-20 21:12:03,005 - root - INFO - timer:154 - Completed: Loading all test images in 2.93 seconds
2025-10-20 21:12:03,006 - root - INFO - timer:148 - Starting: Loading training data
2025-10-20 21:12:03,006 - src.data.load_data - INFO - load_data:150 - Processing 5 images for training data...
2025-10-20 21:12:04,920 - src.data.load_data - INFO - load_data:184 - Successfully loaded and processed 5/5 images.
2025-10-20 21:12:04,920 - src.data.load_data - INFO - load_data:185 - rgb_data shape: (5, 30000), lab_data shape: (5, 30000)
2025-10-20 21:12:04,924 - root - INFO - validate_loaded_data:267 - Data validation passed: 50000 total pixels available from 5 images.
2025-10-20 21:12:04,925 - root - INFO - timer:154 - Completed: Loading training data in 1.92 seconds
2025-10-20 21:12:04,925 - root - INFO - timer:148 - Starting: DBN initialization and training
2025-10-20 21:12:04,925 - src.models.dbn_trainer - INFO - __init__:48 - DBNTrainer initialized.
2025-10-20 21:12:04,926 - src.models.dbn_trainer - INFO - train:64 - Starting DBN training and PSO optimization process...
2025-10-20 21:12:04,926 - src.data.preprocess - INFO - efficient_data_sampling:207 - Sampling 800 total samples from flattened data, max 160 per image
2025-10-20 21:12:04,929 - src.data.preprocess - INFO - efficient_data_sampling:282 - Sampling completed: 800 samples extracted.
2025-10-20 21:12:04,929 - src.data.preprocess - INFO - efficient_data_sampling:283 - RGB range: [31.00, 213.00]
2025-10-20 21:12:04,930 - src.data.preprocess - INFO - efficient_data_sampling:284 - LAB ranges: L[12.16, 84.31], a[-2.00, 2.00], b[-1.00, 8.00]
2025-10-20 21:12:04,931 - src.models.dbn_trainer - INFO - train:77 - Training set: (640, 3), Test set: (160, 3)
2025-10-20 21:12:04,931 - src.models.dbn_trainer - INFO - _prepare_scalers:109 - Preparing and fitting scalers...
2025-10-20 21:12:04,936 - src.models.dbn_trainer - INFO - _prepare_scalers:128 - Scaled training data - X: (640, 3), Y: (640, 3)
2025-10-20 21:12:04,936 - src.models.dbn_trainer - INFO - _prepare_scalers:129 - X range: [0.000, 1.000]
2025-10-20 21:12:04,937 - src.models.dbn_trainer - INFO - _prepare_scalers:130 - Y range: [0.000, 1.000]
2025-10-20 21:12:04,937 - src.models.pso_dbn - INFO - __init__:89 - Initializing DBN with architecture: 3 -> [100, 50, 25] -> 3
2025-10-20 21:12:05,212 - src.models.pso_dbn - INFO - _build_model:141 - DBN model built with 7503 parameters
2025-10-20 21:12:05,265 - src.models.dbn_trainer - INFO - train:88 - Initial model has 20 weight layers
2025-10-20 21:12:05,265 - src.models.dbn_trainer - INFO - train:90 - Layer 0: shape (3, 100), range [-0.241, 0.241]
2025-10-20 21:12:05,265 - src.models.dbn_trainer - INFO - train:90 - Layer 1: shape (100,), range [0.000, 0.000]
2025-10-20 21:12:05,265 - src.models.dbn_trainer - INFO - train:90 - Layer 2: shape (100,), range [1.000, 1.000]
2025-10-20 21:12:05,265 - src.models.dbn_trainer - INFO - train:90 - Layer 3: shape (100,), range [0.000, 0.000]
2025-10-20 21:12:05,265 - src.models.dbn_trainer - INFO - train:90 - Layer 4: shape (100,), range [0.000, 0.000]
2025-10-20 21:12:05,266 - src.models.dbn_trainer - INFO - train:90 - Layer 5: shape (100,), range [1.000, 1.000]
2025-10-20 21:12:05,266 - src.models.dbn_trainer - INFO - train:90 - Layer 6: shape (100, 50), range [-0.200, 0.200]
2025-10-20 21:12:05,266 - src.models.dbn_trainer - INFO - train:90 - Layer 7: shape (50,), range [0.000, 0.000]
2025-10-20 21:12:05,266 - src.models.dbn_trainer - INFO - train:90 - Layer 8: shape (50,), range [1.000, 1.000]
2025-10-20 21:12:05,266 - src.models.dbn_trainer - INFO - train:90 - Layer 9: shape (50,), range [0.000, 0.000]
2025-10-20 21:12:05,266 - src.models.dbn_trainer - INFO - train:90 - Layer 10: shape (50,), range [0.000, 0.000]
2025-10-20 21:12:05,266 - src.models.dbn_trainer - INFO - train:90 - Layer 11: shape (50,), range [1.000, 1.000]
2025-10-20 21:12:05,267 - src.models.dbn_trainer - INFO - train:90 - Layer 12: shape (50, 25), range [-0.283, 0.282]
2025-10-20 21:12:05,267 - src.models.dbn_trainer - INFO - train:90 - Layer 13: shape (25,), range [0.000, 0.000]
2025-10-20 21:12:05,267 - src.models.dbn_trainer - INFO - train:90 - Layer 14: shape (25,), range [1.000, 1.000]
2025-10-20 21:12:05,267 - src.models.dbn_trainer - INFO - train:90 - Layer 15: shape (25,), range [0.000, 0.000]
2025-10-20 21:12:05,267 - src.models.dbn_trainer - INFO - train:90 - Layer 16: shape (25,), range [0.000, 0.000]
2025-10-20 21:12:05,267 - src.models.dbn_trainer - INFO - train:90 - Layer 17: shape (25,), range [1.000, 1.000]
2025-10-20 21:12:05,267 - src.models.dbn_trainer - INFO - train:90 - Layer 18: shape (25, 3), range [-0.455, 0.454]
2025-10-20 21:12:05,267 - src.models.dbn_trainer - INFO - train:90 - Layer 19: shape (3,), range [0.000, 0.000]
2025-10-20 21:12:05,267 - src.models.dbn_trainer - INFO - _run_pso_with_retries:139 - PSO optimization attempt 1/3
2025-10-20 21:12:05,268 - src.models.pso_dbn - INFO - optimize:253 - Starting PSO optimization with config: {'swarmsize': 20, 'maxiter': 50, 'w': 0.7, 'c1': 2.0, 'c2': 2.0}
2025-10-20 21:14:35,833 - src.models.pso_dbn - INFO - optimize:326 - PSO optimization completed in 150.56s - Final fitness: 0.051713
2025-10-20 21:14:35,834 - src.models.dbn_trainer - INFO - _run_pso_with_retries:154 - PSO optimization completed successfully
2025-10-20 21:14:35,844 - src.models.dbn_trainer - INFO - train:96 - DBN training and PSO optimization complete.
2025-10-20 21:14:35,844 - root - INFO - timer:154 - Completed: DBN initialization and training in 150.92 seconds
2025-10-20 21:14:35,845 - root - INFO - timer:148 - Starting: Reference image loading and processing
2025-10-20 21:14:37,385 - src.utils.output_manager - INFO - save_reference_image:67 - Saved reference image copy to datasets\block\inputs\reference_image\reference.png
2025-10-20 21:14:37,386 - root - INFO - process_reference_image:255 - Processing reference image: C:\Users\LENOVO\Desktop\prints\dataset\block\reference.jpg
2025-10-20 21:14:37,782 - root - INFO - process_reference_image:266 - Starting preprocessing for reference image
2025-10-20 21:14:37,782 - src.data.preprocess - INFO - preprocess:140 - Starting preprocessing for image with shape: (4480, 4480, 3)
2025-10-20 21:14:37,812 - src.data.preprocess - INFO - preprocess:153 - Initial resize from 4480x4480 to 512x512
2025-10-20 21:14:39,085 - src.data.preprocess - INFO - preprocess:157 - Applied non-local means denoising with h=10
2025-10-20 21:14:39,401 - src.data.preprocess - INFO - estimate_n_colors:64 - Estimated 299 unique colors, setting n_colors to 8 (max_colors=8)
2025-10-20 21:14:40,113 - src.data.preprocess - INFO - quantize_image:106 - Quantized to 8 target colors. Final unique colors: 8
2025-10-20 21:14:40,114 - src.data.preprocess - INFO - preprocess:176 - Resized to target size (128, 128)
2025-10-20 21:14:40,115 - src.data.preprocess - INFO - preprocess:178 - Preprocessing completed
2025-10-20 21:14:40,115 - root - INFO - process_reference_image:273 - Preprocessing completed for reference image, shape: (128, 128, 3)
2025-10-20 21:14:40,115 - root - INFO - process_reference_image:283 - Determining optimal number of clusters for reference image
2025-10-20 21:14:40,115 - root - ERROR - process_reference_image:302 - Failed to determine optimal clusters for reference: name 'config' is not defined. Falling back to default_k=2
Traceback (most recent call last):
  File "c:\Users\LENOVO\Desktop\prints\src\utils\image_utils.py", line 288, in process_reference_image
    k_val_default = list(range(2, config.get('segmentation_params', {}).get('max_clusters', 8) + 1))
NameError: name 'config' is not defined
2025-10-20 21:14:40,116 - root - INFO - process_reference_image:306 - Determining the number of clusters using DPC (for reference info)
2025-10-20 21:14:40,119 - root - ERROR - process_reference_image:312 - Failed to calculate DPC k: local variable 'pixels_subsample' referenced before assignment. Setting dpc_k to None.
Traceback (most recent call last):
  File "c:\Users\LENOVO\Desktop\prints\src\utils\image_utils.py", line 310, in process_reference_image
    dpc_k = optimal_clusters_dpc(pixels_subsample, min_k=2, max_k=10)
UnboundLocalError: local variable 'pixels_subsample' referenced before assignment
2025-10-20 21:14:40,119 - root - INFO - process_reference_image:315 - Performing reference segmentation with k=2
2025-10-20 21:14:40,120 - root - ERROR - process_reference_image:394 - Error during reference segmentation execution: local variable 'cluster_strategy' referenced before assignment
Traceback (most recent call last):
  File "c:\Users\LENOVO\Desktop\prints\src\utils\image_utils.py", line 332, in process_reference_image
    kmeans_segmenter = KMeansSegmenter(image_to_segment, seg_config_ref, model_config_ref, cluster_strategy)
UnboundLocalError: local variable 'cluster_strategy' referenced before assignment
2025-10-20 21:14:40,120 - root - INFO - process_reference_image:400 - Reference image processing finished in 2.73 seconds.
2025-10-20 21:14:40,121 - root - INFO - timer:154 - Completed: Reference image loading and processing in 4.28 seconds
2025-10-20 21:14:40,121 - root - ERROR - main:576 - An unexpected error occurred in main execution: Failed to process reference image or received unexpected result format.
Traceback (most recent call last):
  File "c:\Users\LENOVO\Desktop\prints\src\main.py", line 533, in main
    target_colors_lab, ref_kmeans, ref_som = run_reference_processing(
  File "c:\Users\LENOVO\Desktop\prints\src\main.py", line 354, in run_reference_processing
    raise ValueError("Failed to process reference image or received unexpected result format.")
ValueError: Failed to process reference image or received unexpected result format.
2025-10-20 21:14:40,122 - root - INFO - main:583 - ================================================================================
PROCESSING COMPLETED IN 160.07 SECONDS
================================================================================
2025-10-20 21:14:40,186 - root - INFO - main:591 - Profiling results saved to: C:\Users\LENOVO\Desktop\prints\output\profile_stats.txt
2025-10-24 16:02:29,303 - root - INFO - setup_logging:135 - Logging setup complete. Log file: C:\Users\LENOVO\Desktop\prints\output\processing.log
2025-10-24 16:02:29,304 - root - INFO - timer:148 - Starting: Configuration loading and validation
2025-10-24 16:02:29,316 - src.data.load_data - INFO - load_config:51 - Loaded default configuration from c:\Users\LENOVO\Desktop\prints\configurations\defaults.yaml
2025-10-24 16:02:29,324 - src.data.load_data - INFO - load_config:61 - Loading specific configuration from C:\Users\LENOVO\Desktop\prints\configurations\pattern_configs\block_config.yaml...
2025-10-24 16:02:29,325 - src.data.load_data - INFO - load_config:66 - Merged specific configuration over defaults.
2025-10-24 16:02:29,325 - src.data.load_data - INFO - load_config:77 - Configuration loaded successfully.
2025-10-24 16:02:29,328 - root - INFO - validate_processing_config:232 - Processing configuration validation passed
2025-10-24 16:02:29,328 - root - INFO - timer:154 - Completed: Configuration loading and validation in 0.02 seconds
2025-10-24 16:02:29,330 - src.utils.output_manager - INFO - __init__:28 - OutputManager initialized for dataset 'block' at C:\Users\LENOVO\Desktop\prints\output\datasets\block
2025-10-24 16:02:29,330 - root - INFO - main:500 - Processing dataset: block
2025-10-24 16:02:29,331 - root - INFO - timer:148 - Starting: Loading all test images
2025-10-24 16:02:30,039 - src.utils.output_manager - INFO - save_test_image:77 - Saved test image copy to datasets\block\inputs\test_images\block1.jpg
2025-10-24 16:02:30,899 - src.utils.output_manager - INFO - save_test_image:77 - Saved test image copy to datasets\block\inputs\test_images\block2.jpg
2025-10-24 16:02:31,382 - src.utils.output_manager - INFO - save_test_image:77 - Saved test image copy to datasets\block\inputs\test_images\block3.jpg
2025-10-24 16:02:31,916 - src.utils.output_manager - INFO - save_test_image:77 - Saved test image copy to datasets\block\inputs\test_images\block4.jpg
2025-10-24 16:02:32,508 - src.utils.output_manager - INFO - save_test_image:77 - Saved test image copy to datasets\block\inputs\test_images\block5.jpg
2025-10-24 16:02:32,508 - root - INFO - timer:154 - Completed: Loading all test images in 3.18 seconds
2025-10-24 16:02:32,508 - root - INFO - timer:148 - Starting: Loading training data
2025-10-24 16:02:32,508 - src.data.load_data - INFO - load_data:150 - Processing 5 images for training data...
2025-10-24 16:02:34,499 - src.data.load_data - INFO - load_data:184 - Successfully loaded and processed 5/5 images.
2025-10-24 16:02:34,499 - src.data.load_data - INFO - load_data:185 - rgb_data shape: (5, 30000), lab_data shape: (5, 30000)
2025-10-24 16:02:34,508 - root - INFO - validate_loaded_data:267 - Data validation passed: 50000 total pixels available from 5 images.
2025-10-24 16:02:34,508 - root - INFO - timer:154 - Completed: Loading training data in 2.00 seconds
2025-10-24 16:02:34,508 - root - INFO - timer:148 - Starting: DBN initialization and training
2025-10-24 16:02:34,508 - src.models.dbn_trainer - INFO - __init__:48 - DBNTrainer initialized.
2025-10-24 16:02:34,508 - src.models.dbn_trainer - INFO - train:64 - Starting DBN training and PSO optimization process...
2025-10-24 16:02:34,508 - src.data.preprocess - INFO - efficient_data_sampling:207 - Sampling 800 total samples from flattened data, max 160 per image
2025-10-24 16:02:34,520 - src.data.preprocess - INFO - efficient_data_sampling:282 - Sampling completed: 800 samples extracted.
2025-10-24 16:02:34,520 - src.data.preprocess - INFO - efficient_data_sampling:283 - RGB range: [31.00, 213.00]
2025-10-24 16:02:34,520 - src.data.preprocess - INFO - efficient_data_sampling:284 - LAB ranges: L[11.76, 84.31], a[-2.00, 2.00], b[-1.00, 8.00]
2025-10-24 16:02:34,524 - src.models.dbn_trainer - INFO - train:77 - Training set: (640, 3), Test set: (160, 3)
2025-10-24 16:02:34,524 - src.models.dbn_trainer - INFO - _prepare_scalers:109 - Preparing and fitting scalers...
2025-10-24 16:02:34,529 - src.models.dbn_trainer - INFO - _prepare_scalers:128 - Scaled training data - X: (640, 3), Y: (640, 3)
2025-10-24 16:02:34,529 - src.models.dbn_trainer - INFO - _prepare_scalers:129 - X range: [0.000, 1.000]
2025-10-24 16:02:34,530 - src.models.dbn_trainer - INFO - _prepare_scalers:130 - Y range: [0.000, 1.000]
2025-10-24 16:02:34,530 - src.models.pso_dbn - INFO - __init__:89 - Initializing DBN with architecture: 3 -> [100, 50, 25] -> 3
2025-10-24 16:02:34,924 - src.models.pso_dbn - INFO - _build_model:141 - DBN model built with 7503 parameters
2025-10-24 16:02:35,019 - src.models.dbn_trainer - INFO - train:88 - Initial model has 20 weight layers
2025-10-24 16:02:35,019 - src.models.dbn_trainer - INFO - train:90 - Layer 0: shape (3, 100), range [-0.241, 0.240]
2025-10-24 16:02:35,019 - src.models.dbn_trainer - INFO - train:90 - Layer 1: shape (100,), range [0.000, 0.000]
2025-10-24 16:02:35,019 - src.models.dbn_trainer - INFO - train:90 - Layer 2: shape (100,), range [1.000, 1.000]
2025-10-24 16:02:35,019 - src.models.dbn_trainer - INFO - train:90 - Layer 3: shape (100,), range [0.000, 0.000]
2025-10-24 16:02:35,019 - src.models.dbn_trainer - INFO - train:90 - Layer 4: shape (100,), range [0.000, 0.000]
2025-10-24 16:02:35,019 - src.models.dbn_trainer - INFO - train:90 - Layer 5: shape (100,), range [1.000, 1.000]
2025-10-24 16:02:35,019 - src.models.dbn_trainer - INFO - train:90 - Layer 6: shape (100, 50), range [-0.200, 0.200]
2025-10-24 16:02:35,019 - src.models.dbn_trainer - INFO - train:90 - Layer 7: shape (50,), range [0.000, 0.000]
2025-10-24 16:02:35,019 - src.models.dbn_trainer - INFO - train:90 - Layer 8: shape (50,), range [1.000, 1.000]
2025-10-24 16:02:35,019 - src.models.dbn_trainer - INFO - train:90 - Layer 9: shape (50,), range [0.000, 0.000]
2025-10-24 16:02:35,019 - src.models.dbn_trainer - INFO - train:90 - Layer 10: shape (50,), range [0.000, 0.000]
2025-10-24 16:02:35,019 - src.models.dbn_trainer - INFO - train:90 - Layer 11: shape (50,), range [1.000, 1.000]
2025-10-24 16:02:35,024 - src.models.dbn_trainer - INFO - train:90 - Layer 12: shape (50, 25), range [-0.282, 0.283]
2025-10-24 16:02:35,024 - src.models.dbn_trainer - INFO - train:90 - Layer 13: shape (25,), range [0.000, 0.000]
2025-10-24 16:02:35,024 - src.models.dbn_trainer - INFO - train:90 - Layer 14: shape (25,), range [1.000, 1.000]
2025-10-24 16:02:35,024 - src.models.dbn_trainer - INFO - train:90 - Layer 15: shape (25,), range [0.000, 0.000]
2025-10-24 16:02:35,024 - src.models.dbn_trainer - INFO - train:90 - Layer 16: shape (25,), range [0.000, 0.000]
2025-10-24 16:02:35,024 - src.models.dbn_trainer - INFO - train:90 - Layer 17: shape (25,), range [1.000, 1.000]
2025-10-24 16:02:35,024 - src.models.dbn_trainer - INFO - train:90 - Layer 18: shape (25, 3), range [-0.435, 0.446]
2025-10-24 16:02:35,024 - src.models.dbn_trainer - INFO - train:90 - Layer 19: shape (3,), range [0.000, 0.000]
2025-10-24 16:02:35,024 - src.models.dbn_trainer - INFO - _run_pso_with_retries:139 - PSO optimization attempt 1/3
2025-10-24 16:02:35,024 - src.models.pso_dbn - INFO - optimize:253 - Starting PSO optimization with config: {'swarmsize': 20, 'maxiter': 50, 'w': 0.7, 'c1': 2.0, 'c2': 2.0}
2025-10-24 16:05:12,915 - src.models.pso_dbn - INFO - optimize:326 - PSO optimization completed in 157.89s - Final fitness: 0.019466
2025-10-24 16:05:12,915 - src.models.dbn_trainer - INFO - _run_pso_with_retries:154 - PSO optimization completed successfully
2025-10-24 16:05:12,928 - src.models.dbn_trainer - INFO - train:96 - DBN training and PSO optimization complete.
2025-10-24 16:05:12,929 - root - INFO - timer:154 - Completed: DBN initialization and training in 158.42 seconds
2025-10-24 16:05:12,929 - root - INFO - timer:148 - Starting: Reference image loading and processing
2025-10-24 16:05:14,595 - src.utils.output_manager - INFO - save_reference_image:67 - Saved reference image copy to datasets\block\inputs\reference_image\reference.png
2025-10-24 16:05:14,595 - root - INFO - process_reference_image:255 - Processing reference image: C:\Users\LENOVO\Desktop\prints\dataset\block\reference.jpg
2025-10-24 16:05:15,000 - root - INFO - process_reference_image:266 - Starting preprocessing for reference image
2025-10-24 16:05:15,000 - src.data.preprocess - INFO - preprocess:140 - Starting preprocessing for image with shape: (4480, 4480, 3)
2025-10-24 16:05:15,029 - src.data.preprocess - INFO - preprocess:153 - Initial resize from 4480x4480 to 512x512
2025-10-24 16:05:16,372 - src.data.preprocess - INFO - preprocess:157 - Applied non-local means denoising with h=10
2025-10-24 16:05:16,685 - src.data.preprocess - INFO - estimate_n_colors:64 - Estimated 299 unique colors, setting n_colors to 8 (max_colors=8)
2025-10-24 16:05:17,527 - src.data.preprocess - INFO - quantize_image:106 - Quantized to 8 target colors. Final unique colors: 8
2025-10-24 16:05:17,531 - src.data.preprocess - INFO - preprocess:176 - Resized to target size (128, 128)
2025-10-24 16:05:17,531 - src.data.preprocess - INFO - preprocess:178 - Preprocessing completed
2025-10-24 16:05:17,531 - root - INFO - process_reference_image:273 - Preprocessing completed for reference image, shape: (128, 128, 3)
2025-10-24 16:05:17,531 - root - INFO - process_reference_image:283 - Determining optimal number of clusters for reference image
2025-10-24 16:05:17,531 - root - ERROR - process_reference_image:302 - Failed to determine optimal clusters for reference: name 'config' is not defined. Falling back to default_k=2
Traceback (most recent call last):
  File "c:\Users\LENOVO\Desktop\prints\src\utils\image_utils.py", line 288, in process_reference_image
    k_val_default = list(range(2, config.get('segmentation_params', {}).get('max_clusters', 8) + 1))
NameError: name 'config' is not defined
2025-10-24 16:05:17,531 - root - INFO - process_reference_image:306 - Determining the number of clusters using DPC (for reference info)
2025-10-24 16:05:17,531 - root - ERROR - process_reference_image:312 - Failed to calculate DPC k: local variable 'pixels_subsample' referenced before assignment. Setting dpc_k to None.
Traceback (most recent call last):
  File "c:\Users\LENOVO\Desktop\prints\src\utils\image_utils.py", line 310, in process_reference_image
    dpc_k = optimal_clusters_dpc(pixels_subsample, min_k=2, max_k=10)
UnboundLocalError: local variable 'pixels_subsample' referenced before assignment
2025-10-24 16:05:17,531 - root - INFO - process_reference_image:315 - Performing reference segmentation with k=2
2025-10-24 16:05:17,531 - root - ERROR - process_reference_image:394 - Error during reference segmentation execution: local variable 'cluster_strategy' referenced before assignment
Traceback (most recent call last):
  File "c:\Users\LENOVO\Desktop\prints\src\utils\image_utils.py", line 332, in process_reference_image
    kmeans_segmenter = KMeansSegmenter(image_to_segment, seg_config_ref, model_config_ref, cluster_strategy)
UnboundLocalError: local variable 'cluster_strategy' referenced before assignment
2025-10-24 16:05:17,531 - root - INFO - process_reference_image:400 - Reference image processing finished in 2.94 seconds.
2025-10-24 16:05:17,535 - root - INFO - timer:154 - Completed: Reference image loading and processing in 4.61 seconds
2025-10-24 16:05:17,535 - root - ERROR - main:576 - An unexpected error occurred in main execution: Failed to process reference image or received unexpected result format.
Traceback (most recent call last):
  File "c:\Users\LENOVO\Desktop\prints\src\main.py", line 533, in main
    target_colors_lab, ref_kmeans, ref_som = run_reference_processing(
  File "c:\Users\LENOVO\Desktop\prints\src\main.py", line 354, in run_reference_processing
    raise ValueError("Failed to process reference image or received unexpected result format.")
ValueError: Failed to process reference image or received unexpected result format.
2025-10-24 16:05:17,535 - root - INFO - main:583 - ================================================================================
PROCESSING COMPLETED IN 168.24 SECONDS
================================================================================
2025-10-24 16:05:17,604 - root - INFO - main:591 - Profiling results saved to: C:\Users\LENOVO\Desktop\prints\output\profile_stats.txt
